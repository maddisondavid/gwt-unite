<!--
	This script acts as a generic GWT-Unite service builder
	
	It is not designed to be called directly, but rather from parent scripts
-->
<project name="OperaUnite-Service-Builder" basedir=".">
	<property name="GWT_HOME" value="c:/program files/gwt-windows-1.7.0"/>

	<property name="build.dir" value="build"/>
	<property name="dist.dir" value="dist"/>
		
	<target name="compile">
		<java fork="true" classname="com.google.gwt.dev.Compiler" failOnError="true">
			<classpath>
				<pathelement location="src"/>
				<pathelement location="${GWT_HOME}/gwt-dev-windows.jar"/>
				<pathelement location="${GWT_HOME}/gwt-user.jar"/>
				<fileset dir="lib">
					<include name="**/*.jar" />
				</fileset>
			</classpath>
			<jvmarg line="-Xmx256M"/>
			<arg line="-war ${build.dir} -style detailed ${moduleName}"/>
		</java>
	</target>
	
	<target name="cleanup" depends="compile">
		<!-- GWT adds stuff that was in public directories of modules, we don't need it so get rid of it -->
		<delete>
			<fileset dir="${build.dir}/${dist.moduleName}" includes="*" excludes="index.html"/>
		</delete> 
		<copy file="conf/${dist.config-File}" toFile="${build.dir}/${dist.moduleName}/config.xml"/>
	</target>
	
	<target name="package" depends="cleanup">
		<mkdir dir="${dist.dir}"/>
		<zip basedir="${build.dir}/${dist.moduleName}" file="${dist.dir}/${dist.zipName}"/>
		<delete dir="${build.dir}"/>
	</target>
</project>